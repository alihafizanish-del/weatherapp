

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Weather App (Keyless)</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #6dd5fa, #2980b9);
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .weather-container {
      background: #fff;
      padding: 30px;
      border-radius: 15px;
      width: 420px;
      text-align: center;
      box-shadow: 0px 8px 25px rgba(0, 0, 0, 0.3);
    }
    h2 { margin-bottom: 20px; color: #333; }
    input {
      width: 70%; padding: 12px; border: 1px solid #ccc;
      border-radius: 8px; outline: none; margin-bottom: 15px;
    }
    button {
      padding: 12px 18px; margin: 5px; border: none;
      border-radius: 8px; background: #2980b9; color: white;
      font-size: 15px; cursor: pointer; transition: 0.3s;
    }
    button:hover { background: #1c5984; }
    .weather-result {
      margin-top: 20px; display: none; padding: 20px;
      border-radius: 10px; background: #f3f9ff;
      box-shadow: inset 0px 0px 8px rgba(0, 0, 0, 0.1);
    }
    .weather-result p { font-size: 18px; margin: 8px 0; color: #444; }
    .flag {
      width: 50px; height: 30px; border-radius: 5px; margin-bottom: 10px;
    }
    .icon {
      width: 80px; height: 80px;
    }
  </style>
</head>
<body>
  <div class="weather-container">
    <h2>ğŸŒ¤ Weather App (Keyless)</h2>
    <input type="text" id="cityInput" placeholder="Enter city or country name" />
    <br>
    <button id="searchBtn">Search</button>
    <button id="showBtn">Show Weather</button>

    <div class="weather-result" id="weatherResult">
      <img id="flag" class="flag" src="" alt="Country Flag">
      <p id="location"></p>
      <img id="weatherIcon" class="icon" src="" alt="Weather Icon">
      <p id="tempC"></p>
      <p id="tempF"></p>
      <p id="condition"></p>
    </div>
  </div>

  <script>
    let fetchedData = null;

    document.getElementById("searchBtn").addEventListener("click", async () => {
      const query = document.getElementById("cityInput").value.trim();
      if (!query) return alert("Please enter city or country!");

      // First, get lat/lon via OpenStreetMap Nominatim (no key required)
      try {
        const locRes = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`);
        const locJson = await locRes.json();
        if (!locJson.length) throw new Error("Location not found");

        const { lat, lon, display_name } = locJson[0];

        // Now fetch weather via Open-Meteo (no key)
        const weatherRes = await fetch(
          `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&temperature_unit=celsius&windspeed_unit=kmh`
        );
        const weatherJson = await weatherRes.json();
        if (!weatherJson.current_weather) throw new Error("Weather data unavailable");

        fetchedData = {
          display_name, lat, lon, tempC: weatherJson.current_weather.temperature,
          // Open-meteo gives temp only in Celsius; we convert manually
          tempF: (weatherJson.current_weather.temperature * 9 / 5 + 32).toFixed(2),
          iconCode: weatherJson.current_weather.weathercode
        };

        alert("âœ”ï¸ Data fetched! Now click 'Show Weather'");
      } catch (err) {
        alert(err.message);
        fetchedData = null;
      }
    });

    document.getElementById("showBtn").addEventListener("click", () => {
      if (!fetchedData) return alert("Please fetch data first!");

      // Location display
      document.getElementById("location").innerText = `Location: ${fetchedData.display_name}`;

      // Flag: use country code from display_name (hacky but simple)
      const countryMatch = fetchedData.display_name.match(/,\s*([A-Za-z\s]+)$/);
      if (countryMatch) {
        const countryName = countryMatch[1].trim();
        // Quick country name to code lookup (can improve)
        const codes = { Pakistan: 'pk', USA:'us', Canada:'ca', India:'in', UK:'gb' };
        const code = codes[countryName] || countryName.slice(0,2).toLowerCase();
        document.getElementById("flag").src = `https://flagcdn.com/w40/${code}.png`;
      }

      // Weather icon: map weathercode to icon (simplified)
      const icons = {
        0: "â˜€ï¸", 1: "ğŸŒ¤", 2: "â›…", 3: "â˜ï¸", 45: "ğŸŒ«",
        48: "ğŸŒ«", 51: "ğŸŒ¦", 61: "ğŸŒ§", 71: "ğŸŒ¨", 80: "ğŸŒ§", 95: "ğŸŒ©"
      };
      document.getElementById("weatherIcon").alt = icons[fetchedData.iconCode] || "ğŸŒˆ";
      document.getElementById("weatherIcon").title = icons[fetchedData.iconCode] || "";

      document.getElementById("tempC").innerText = `Temperature: ${fetchedData.tempC} Â°C`;
      document.getElementById("tempF").innerText = `Temperature: ${fetchedData.tempF} Â°F`;
      document.getElementById("condition").innerText = `Weather Code: ${fetchedData.iconCode}`;

      document.getElementById("weatherResult").style.display = "block";
    });
  </script>
</body>
</html> 